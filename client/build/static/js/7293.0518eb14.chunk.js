/*! For license information please see 7293.0518eb14.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[7293,9201],{37293(e,s,t){t.r(s),t.d(s,{default:()=>w});var r=t(89379),a=t(65043),l=t(47874),i=t(28845),n=t(90837),o=t(55026),d=t(23768);const c=(0,t(77784).A)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);var p=t(14918),m=t(40614),u=t(70579);function h(e){let{onNext:s}=e;const{cart:t,fetchCart:l,removeFromCart:h}=(0,i.A)(),{addToWishlist:x}=(0,n.A)(),[g,f]=(0,a.useState)(!0),[v,y]=(0,a.useState)(""),[j,w]=(0,a.useState)(!1),[b,N]=(0,a.useState)({line:"",city:"",pin:""}),[k,_]=(0,a.useState)(""),[C,A]=(0,a.useState)([]),S=(0,a.useRef)(null),[R,z]=(0,a.useState)({}),I=e=>{if(!e)return[];const s=(()=>{try{return JSON.parse(e.more_images||"[]")||[]}catch(s){return[]}})();return[e.front_photo,e.back_photo,e.label_photo,e.inside_photo,e.button_photo,e.wearing_photo,...s].filter(Boolean).map(e=>"".concat("https://sellaids.com","/").concat(e))},F=(e,s)=>{z(a=>{var l,i;const n=null!==(l=a[e])&&void 0!==l?l:0,o=I((null===(i=t.find(s=>s.product_id===e))||void 0===i?void 0:i.product)||{});if(0===o.length)return a;let d;return d="number"===typeof s?s<0?(n+s+o.length)%o.length:1===s?(n+1)%o.length:s:(n+1)%o.length,(0,r.A)((0,r.A)({},a),{},{[e]:d})})},P=e=>{e.target.src="https://via.placeholder.com/96"};(0,a.useEffect)(()=>{sessionStorage.removeItem("orderData")},[]),(0,a.useEffect)(()=>{o.A.get("/api/user/profile/list").then(e=>{const s=e.data.data;if(s.address_line&&s.city&&s.pincode){const e="".concat(s.address_line,", ").concat(s.city,", ").concat(s.pincode);y(e),_(e),N({line:s.address_line,city:s.city,pin:s.pincode})}}).catch(()=>d.oR.error("Could not load address")).finally(()=>l().then(()=>f(!1)))},[l]);if(g)return(0,u.jsx)("p",{className:"text-center py-10",children:"Loading\u2026"});const E=t.reduce((e,s)=>e+s.product.price*s.quantity,0),T=E+100+50;return(0,u.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[(0,u.jsx)(d.l$,{}),(0,u.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-4 sm:p-6 flex flex-col sm:flex-row items-start gap-4",children:[(0,u.jsx)(c,{className:"w-5 h-5 sm:w-6 sm:h-6 text-purple-600 mt-1 flex-shrink-0"}),(0,u.jsxs)("div",{className:"flex-1 w-full",children:[(0,u.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-2 gap-3",children:[(0,u.jsx)("p",{className:"font-semibold text-base sm:text-lg",children:"Delivery Address"}),(0,u.jsx)("button",{onClick:()=>w(!0),className:"text-purple-600 text-sm underline hover:text-purple-700",children:"Change"})]}),j?(0,u.jsxs)("div",{className:"space-y-4 mt-3",children:[(0,u.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("input",{placeholder:"Address line",value:b.line,onChange:e=>{return s=e.target.value,N(e=>(0,r.A)((0,r.A)({},e),{},{line:s})),S.current&&clearTimeout(S.current),void(s.length<3?A([]):S.current=setTimeout(async()=>{try{const e=await fetch("https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=5&q=".concat(s)),t=await e.json();A(t)}catch(e){A([])}},400));var s},className:"border rounded px-3 py-2 text-sm w-full"}),C.length>0&&(0,u.jsx)("ul",{className:"absolute z-20 bg-white border rounded mt-1 w-full max-h-48 overflow-auto shadow",children:C.map(e=>(0,u.jsx)("li",{onClick:()=>(e=>{N({line:e.display_name,city:e.address.city||e.address.town||e.address.village||"",pin:e.address.postcode||""}),A([])})(e),className:"px-3 py-2 text-sm cursor-pointer hover:bg-gray-100",children:e.display_name},e.place_id))})]}),(0,u.jsx)("input",{placeholder:"City",value:b.city,onChange:e=>N((0,r.A)((0,r.A)({},b),{},{city:e.target.value})),className:"border rounded px-3 py-2 text-sm w-full"}),(0,u.jsx)("input",{placeholder:"Pincode",value:b.pin,onChange:e=>N((0,r.A)((0,r.A)({},b),{},{pin:e.target.value})),className:"border rounded px-3 py-2 text-sm w-full"})]}),(0,u.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,u.jsx)("button",{onClick:async()=>{const{line:e,city:s,pin:t}=b;if(!e||!s||!t)return void d.oR.error("Please fill all address fields");const r="".concat(e,", ").concat(s,", ").concat(t);try{await o.A.put("/api/user/profile/edit",{address_line:e,city:s,pincode:t}),y(r),_(r),w(!1),d.oR.success("Address saved")}catch(i){var a,l;d.oR.error((null===(a=i.response)||void 0===a||null===(l=a.data)||void 0===l?void 0:l.message)||"Failed to save address")}},className:"px-4 py-1.5 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"Save"}),(0,u.jsx)("button",{onClick:()=>{const e=k.split(", ");3===e.length?N({line:e[0],city:e[1],pin:e[2]}):N({line:"",city:"",pin:""}),w(!1)},className:"px-4 py-1.5 border rounded text-sm hover:bg-gray-100",children:"Cancel"})]})]}):(0,u.jsx)("p",{className:"text-gray-700 text-sm sm:text-base",children:v||"No address added yet"})]})]}),t.map(e=>{var s;const t=e.product,r=I(t),a=null!==(s=R[e.product_id])&&void 0!==s?s:0;return(0,u.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-4 sm:p-6 flex flex-col lg:flex-row gap-6 items-start",children:[(0,u.jsx)("div",{className:"w-full lg:w-48 xl:w-56 flex-shrink-0",children:(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("div",{className:"aspect-square bg-gray-50 rounded-md overflow-hidden flex items-center justify-center",children:(0,u.jsx)("img",{src:r[a]||"https://via.placeholder.com/96",alt:null===t||void 0===t?void 0:t.name,className:"max-w-full max-h-full h-auto object-contain",onError:P})}),r.length>1&&(0,u.jsxs)("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2 flex justify-between px-2 pointer-events-none",children:[(0,u.jsx)("button",{onClick:()=>F(e.product_id,-1),className:"pointer-events-auto bg-white/80 hover:bg-white p-1.5 rounded-full shadow-md",children:(0,u.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,u.jsx)("button",{onClick:()=>F(e.product_id,1),className:"pointer-events-auto bg-white/80 hover:bg-white p-1.5 rounded-full shadow-md",children:(0,u.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),r.length>1&&(0,u.jsx)("div",{className:"mt-3 flex gap-2 overflow-x-auto pb-1 snap-x",children:r.map((s,t)=>(0,u.jsx)("img",{src:s,alt:"thumb ".concat(t+1),className:"w-12 h-12 sm:w-14 sm:h-14 object-cover rounded cursor-pointer flex-shrink-0 snap-center border-2 transition-all ".concat(a===t?"border-purple-600":"border-gray-200"),onClick:()=>F(e.product_id,t),onError:P},t))})]})}),(0,u.jsxs)("div",{className:"flex-1 space-y-3 min-w-0",children:[(0,u.jsx)("p",{className:"font-medium text-base sm:text-lg pr-2",children:null===t||void 0===t?void 0:t.name}),(0,u.jsx)("div",{className:"flex flex-wrap items-center gap-3 text-lg",children:(0,u.jsxs)("p",{className:"font-semibold",children:["\u20b9",(null===t||void 0===t?void 0:t.price)*e.quantity]})}),(0,u.jsx)("p",{className:"text-sm text-gray-600 flex flex-wrap items-center gap-x-4 gap-y-2",children:t.size&&(0,u.jsxs)("span",{children:["Size: ","Other"===t.size?t.size_other:t.size]})})]}),(0,u.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6 text-sm w-full lg:w-auto mt-4 lg:mt-0",children:[(0,u.jsxs)("button",{onClick:()=>(async e=>{try{await o.A.post("/api/user/wishlist",{product_id:e}),await x(e),await h(e),d.oR.success("Moved to wishlist")}catch(r){var s,t;d.oR.error((null===(s=r.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)||"Failed")}})(e.product_id),className:"flex items-center gap-1 text-gray-700 hover:text-purple-600 whitespace-nowrap",children:[(0,u.jsx)(p.A,{className:"w-4 h-4"}),"Move to Wishlist"]}),(0,u.jsx)("span",{className:"hidden sm:block text-gray-400",children:"|"}),(0,u.jsxs)("button",{onClick:()=>h(e.product_id),className:"flex items-center gap-1 text-gray-700 hover:text-red-600 whitespace-nowrap",children:[(0,u.jsx)(m.A,{className:"w-4 h-4"}),"Remove"]})]})]},e.product_id)}),(0,u.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-4 sm:p-6",children:(0,u.jsxs)("div",{className:"space-y-3 text-sm sm:text-base",children:[(0,u.jsxs)("div",{className:"flex justify-between",children:[(0,u.jsx)("span",{children:"Product Total"}),(0,u.jsxs)("span",{children:["\u20b9",E]})]}),(0,u.jsxs)("div",{className:"flex justify-between",children:[(0,u.jsx)("span",{children:"Shipping Fee"}),(0,u.jsxs)("span",{className:"text-green-600",children:["\u20b9",100]})]}),(0,u.jsxs)("div",{className:"flex justify-between",children:[(0,u.jsx)("span",{children:"Platform Fee"}),(0,u.jsxs)("span",{className:"text-green-600",children:["\u20b9",50]})]}),(0,u.jsxs)("div",{className:"flex justify-between font-bold text-base sm:text-lg mt-4 pt-4 border-t border-gray-300",children:[(0,u.jsx)("span",{children:"Final Total"}),(0,u.jsxs)("span",{className:"text-purple-600",children:["\u20b9",T]})]})]})}),(0,u.jsx)("div",{className:"flex justify-end",children:(0,u.jsx)("button",{onClick:()=>{if(!v)return d.oR.error("Add a shipping address");const e=t.reduce((e,s)=>e+s.product.price*s.quantity,0);s({cartItems:t,shippingAddress:v,total:e,finalTotal:e+100+50,shippingFee:100,platformFee:50})},disabled:j,className:"bg-purple-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base",children:"Continue"})})]})}function x(e){let{orderData:s,onPrev:t,onNext:l,onAddressUpdate:i}=e;const{cartItems:n=[],shippingAddress:p="",total:m=0,finalTotal:h=0,shippingFee:x=100,platformFee:g=50}=s||{},[f,v]=(0,a.useState)(p),[y,j]=(0,a.useState)(!1),[w,b]=(0,a.useState)({line:"",city:"",pin:""}),[N,k]=(0,a.useState)(!1),_=e=>{const s=e.split(", ");return 3===s.length?{line:s[0],city:s[1],pin:s[2]}:{line:"",city:"",pin:""}};(0,a.useEffect)(()=>{p&&(v(p),b(_(p)))},[p]);const[C,A]=(0,a.useState)({}),S=e=>{if(!e)return[];const s=(()=>{try{return JSON.parse(e.more_images||"[]")||[]}catch(s){return[]}})();return[e.front_photo,e.back_photo,e.label_photo,e.inside_photo,e.button_photo,e.wearing_photo,...s].filter(Boolean).map(e=>"".concat("https://sellaids.com","/").concat(e))},R=(e,s)=>{A(t=>{var a,l;const i=null!==(a=t[e])&&void 0!==a?a:0,o=S((null===(l=n.find(s=>s.product_id===e))||void 0===l?void 0:l.product)||{});if(0===o.length)return t;let d;return d="number"===typeof s?s<0?(i+s+o.length)%o.length:1===s?(i+1)%o.length:s:(i+1)%o.length,(0,r.A)((0,r.A)({},t),{},{[e]:d})})},z=e=>{e.target.src="https://via.placeholder.com/96"};return(0,u.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6 py-4",children:[(0,u.jsx)(d.l$,{}),(0,u.jsx)("h2",{className:"text-2xl sm:text-3xl font-bold text-center sm:text-left",children:"Review Your Order"}),(0,u.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-5 sm:p-6 flex flex-col sm:flex-row items-start gap-4",children:[(0,u.jsx)(c,{className:"w-6 h-6 text-purple-600 flex-shrink-0 mt-1"}),(0,u.jsxs)("div",{className:"flex-1 w-full",children:[(0,u.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-3 gap-3",children:[(0,u.jsx)("p",{className:"font-semibold text-lg",children:"Delivery Address"}),(0,u.jsx)("button",{onClick:()=>j(!0),className:"text-purple-600 text-sm underline hover:text-purple-700",children:"Change"})]}),y?(0,u.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,u.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,u.jsx)("input",{placeholder:"Address line",value:w.line,onChange:e=>b((0,r.A)((0,r.A)({},w),{},{line:e.target.value})),className:"border rounded-lg px-4 py-3 text-sm w-full"}),(0,u.jsx)("input",{placeholder:"City",value:w.city,onChange:e=>b((0,r.A)((0,r.A)({},w),{},{city:e.target.value})),className:"border rounded-lg px-4 py-3 text-sm w-full"}),(0,u.jsx)("input",{placeholder:"Pincode",value:w.pin,onChange:e=>b((0,r.A)((0,r.A)({},w),{},{pin:e.target.value})),className:"border rounded-lg px-4 py-3 text-sm w-full"})]}),(0,u.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,u.jsx)("button",{onClick:async()=>{const{line:e,city:s,pin:t}=w;if(!e||!s||!t)return void d.oR.error("Please fill all address fields");const r="".concat(e,", ").concat(s,", ").concat(t);try{await o.A.put("/api/user/profile/edit",{address_line:e,city:s,pincode:t}),v(r),b({line:e,city:s,pin:t}),i(r),j(!1),d.oR.success("Address saved")}catch(a){d.oR.error("Failed to save address")}},className:"px-6 py-2.5 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition",children:"Save"}),(0,u.jsx)("button",{onClick:()=>{b(_(f)),j(!1)},className:"px-6 py-2.5 border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 transition",children:"Cancel"})]})]}):(0,u.jsx)("p",{className:"text-gray-700 text-base mt-1",children:f||"No address set"})]})]}),n.map(e=>{var s;const t=e.product,r=S(t),a=null!==(s=C[e.product_id])&&void 0!==s?s:0;return(0,u.jsx)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:(0,u.jsxs)("div",{className:"p-5 sm:p-6 flex flex-col lg:flex-row gap-6 items-start",children:[(0,u.jsx)("div",{className:"w-full lg:w-64 flex-shrink-0",children:(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("div",{className:"aspect-square bg-gray-50 rounded-lg overflow-hidden flex items-center justify-center",children:(0,u.jsx)("img",{src:r[a]||"https://via.placeholder.com/300",alt:null===t||void 0===t?void 0:t.name,className:"w-full h-full object-contain",onError:z})}),r.length>1&&(0,u.jsxs)("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2 flex justify-between px-3 pointer-events-none",children:[(0,u.jsx)("button",{onClick:()=>R(e.product_id,-1),className:"pointer-events-auto bg-white/90 hover:bg-white p-2 rounded-full shadow-lg",children:(0,u.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,u.jsx)("button",{onClick:()=>R(e.product_id,1),className:"pointer-events-auto bg-white/90 hover:bg-white p-2 rounded-full shadow-lg",children:(0,u.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),r.length>1&&(0,u.jsx)("div",{className:"mt-4 flex gap-2 overflow-x-auto snap-x snap-mandatory pb-2",children:r.map((s,t)=>(0,u.jsx)("button",{onClick:()=>R(e.product_id,t),className:"flex-shrink-0 snap-center border-2 rounded-md overflow-hidden transition-all ".concat(a===t?"border-purple-600":"border-gray-200"),children:(0,u.jsx)("img",{src:s,alt:"thumb ".concat(t+1),className:"w-16 h-16 object-cover",onError:z})},t))})]})}),(0,u.jsxs)("div",{className:"flex-1 space-y-3 min-w-0",children:[(0,u.jsx)("h3",{className:"font-semibold text-lg",children:null===t||void 0===t?void 0:t.name}),(0,u.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,u.jsxs)("span",{className:"font-bold text-xl",children:["\u20b9",(null===t||void 0===t?void 0:t.price)*e.quantity]}),(null===t||void 0===t?void 0:t.original_price)>(null===t||void 0===t?void 0:t.price)&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("span",{className:"text-gray-500 line-through text-base",children:["\u20b9",(null===t||void 0===t?void 0:t.original_price)*e.quantity]}),(0,u.jsxs)("span",{className:"text-green-600 font-medium",children:[Math.round((t.original_price-t.price)/t.original_price*100),"% off"]})]})]}),(0,u.jsx)("p",{className:"text-sm text-gray-600",children:t.size&&(0,u.jsxs)("span",{children:["Size: ","Other"===t.size?t.size_other:t.size]})})]})]})},e.product_id)}),(0,u.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-5 sm:p-6",children:(0,u.jsxs)("div",{className:"space-y-3 text-base",children:[(0,u.jsxs)("div",{className:"flex justify-between",children:[(0,u.jsx)("span",{children:"Product Total"}),(0,u.jsxs)("span",{className:"font-medium",children:["\u20b9",m]})]}),(0,u.jsxs)("div",{className:"flex justify-between",children:[(0,u.jsx)("span",{children:"Shipping Fee"}),(0,u.jsxs)("span",{className:"text-green-600",children:["\u20b9",x]})]}),(0,u.jsxs)("div",{className:"flex justify-between",children:[(0,u.jsx)("span",{children:"Platform Fee"}),(0,u.jsxs)("span",{className:"text-green-600",children:["\u20b9",g]})]}),(0,u.jsxs)("div",{className:"pt-4 border-t-2 border-gray-200 flex justify-between text-lg font-bold",children:[(0,u.jsx)("span",{children:"Final Total"}),(0,u.jsxs)("span",{className:"text-purple-600 text-xl",children:["\u20b9",h]})]})]})}),(0,u.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-center",children:[(0,u.jsx)("button",{onClick:t,className:"w-full sm:w-auto px-8 py-3 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition text-base",children:"Back"}),(0,u.jsx)("button",{onClick:async()=>{if(f){k(!0);try{const e=await o.A.post("/api/payment/create-order",{cartItems:n,shippingAddress:f,finalTotal:h});if(!e.data.success)throw new Error(e.data.message);const t=e.data.data,a=(0,r.A)((0,r.A)((0,r.A)({},s),t),{},{finalTotal:h,shippingFee:x,platformFee:g});l(a)}catch(a){var e,t;d.oR.error((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to create order")}finally{k(!1)}}else d.oR.error("Please add a shipping address")},disabled:y||N||!f,className:"w-full sm:w-auto px-10 py-3.5 bg-purple-600 text-white rounded-lg font-semibold text-lg hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition",children:N?"Creating Order...":"Proceed to Payment"})]})]})}var g=t(69201);const f="checkout_order_data";function v(e){let{orderData:s,onPrev:t,onCheckoutComplete:l}=e;const[i,n]=(0,a.useState)(s);return(0,a.useEffect)(()=>{if(!s){const e=sessionStorage.getItem(f);e&&n(JSON.parse(e))}},[s]),(0,a.useEffect)(()=>{i?sessionStorage.setItem(f,JSON.stringify(i)):sessionStorage.removeItem(f)},[i]),(0,a.useEffect)(()=>{var e;!i||null!==(e=window.location.state)&&void 0!==e&&e.orderData||window.history.replaceState((0,r.A)((0,r.A)({},window.history.state),{},{orderData:i}),"")},[i]),i?(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsx)(g.default,{orderData:i,onSuccess:l,isCheckoutFlow:!0}),(0,u.jsx)("div",{className:"flex justify-start",children:(0,u.jsx)("button",{onClick:t,className:"px-5 py-2 border rounded hover:bg-gray-100",children:"Back to Review"})})]}):(0,u.jsxs)("div",{className:"text-center py-10",children:[(0,u.jsx)("p",{children:"Loading order data..."}),(0,u.jsx)("button",{onClick:t,className:"mt-4 px-5 py-2 border rounded hover:bg-gray-100",children:"Back"})]})}const y=["Cart","Review","Payment"],j="checkout_order_data";function w(){const[e,s]=(0,a.useState)(0),[t,i]=(0,a.useState)(null),n=(0,l.Zp)();(0,a.useEffect)(()=>{sessionStorage.removeItem(j),i(null),s(0)},[]),(0,a.useEffect)(()=>{t&&e>0?sessionStorage.setItem(j,JSON.stringify(t)):0===e&&sessionStorage.removeItem(j)},[t,e]);const o=e=>{i(e),s(e=>e+1)},d=()=>s(e=>Math.max(0,e-1));return(0,u.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,u.jsx)("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:(0,u.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-3 flex items-center justify-between",children:y.map((s,t)=>(0,u.jsxs)("div",{className:"flex-1 flex items-center",children:[(0,u.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium\n                  ".concat(t<e?"bg-green-600 text-white":t===e?"bg-purple-600 text-white":"bg-gray-300 text-gray-600"),children:t+1}),(0,u.jsx)("span",{className:"ml-2 text-sm hidden sm:inline",children:s}),t<y.length-1&&(0,u.jsx)("div",{className:"flex-1 h-0.5 mx-2 ".concat(t<e?"bg-green-600":"bg-gray-300")})]},t))})}),(0,u.jsxs)("div",{className:" mx-auto",children:[0===e&&(0,u.jsx)(h,{onNext:o}),1===e&&(0,u.jsx)(x,{orderData:t,onPrev:d,onNext:o,onAddressUpdate:e=>{i(s=>(0,r.A)((0,r.A)({},s),{},{shippingAddress:e}))}}),2===e&&(0,u.jsx)(v,{orderData:t,onPrev:d,onCheckoutComplete:()=>{sessionStorage.removeItem(j),i(null),s(0),n("/user/orders")}})]})]})}},55026(e,s,t){t.d(s,{A:()=>i});var r=t(79722),a=t(24974);const l=r.A.create({baseURL:"https://sellaids.com",withCredentials:!0});l.interceptors.request.use(e=>{const s=a.k.getState().token;return s&&(e.headers.Authorization="Bearer ".concat(s)),e}),l.interceptors.response.use(e=>e,e=>{var s;return 401===(null===(s=e.response)||void 0===s?void 0:s.status)&&(a.k.getState().logout(),window.location.href="/UserAuth/UserLogin"),Promise.reject(e)});const i=l},69201(e,s,t){t.r(s),t.d(s,{default:()=>p});var r=t(65043),a=t(47874),l=t(24974),i=t(28845),n=t(79722),o=t(23768),d=t(70579);const c="checkout_order_data";function p(e){let{orderData:s,onSuccess:t,isCheckoutFlow:p=!1}=e;const{user:m,isAuthenticated:u,fetchUser:h}=(0,l.k)(),{clearCart:x}=(0,i.A)(),g=((0,a.zy)(),(0,a.Zp)()),[f,v]=(0,r.useState)(s),[y,j]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{if(p&&s)return v(s),void j(!1);const e=sessionStorage.getItem(c);if(e)return v(JSON.parse(e)),void j(!1);null!==m&&void 0!==m&&m.id&&await w(),j(!1)})()},[s,p,null===m||void 0===m?void 0:m.id]);const w=async()=>{try{const e=await n.A.get("".concat("https://sellaids.com","/api/payment/user/").concat(m.id,"/latest-order"),{withCredentials:!0});v(e.data.data)}catch(e){console.error("Failed to fetch latest order:",e),o.oR.error("Could not load order. Redirecting..."),setTimeout(()=>g("/user"),1500)}},b=()=>{if(!window.Razorpay)return;const e={key:f.key,order_id:f.razorpayOrderId,amount:f.amount,currency:f.currency,name:"Sellaids",description:"Payment for your order",handler:async e=>{try{(await n.A.post("".concat("https://sellaids.com","/api/payment/verify"),{razorpay_order_id:e.razorpay_order_id,razorpay_payment_id:e.razorpay_payment_id,razorpay_signature:e.razorpay_signature,orderIds:f.orderIds},{withCredentials:!0})).data.success?(o.oR.success("Payment Successful!"),await x(),sessionStorage.removeItem(c),t&&t(),setTimeout(()=>g("/user"),1500)):o.oR.error("Payment verification failed!")}catch(s){o.oR.error("Payment verification failed!")}},modal:{ondismiss:async()=>{o.oR.loading("Cancelling payment...");try{await n.A.post("".concat("https://sellaids.com","/api/payment/cancel"),{razorpayOrderId:f.razorpayOrderId,orderIds:f.orderIds},{withCredentials:!0}),o.oR.dismiss(),o.oR.error("Payment cancelled"),sessionStorage.removeItem(c),setTimeout(()=>g("/user"),1e3)}catch(e){o.oR.dismiss(),o.oR.error("Failed to cancel payment")}}},prefill:{name:(null===m||void 0===m?void 0:m.name)||"",email:(null===m||void 0===m?void 0:m.email)||"",contact:(null===m||void 0===m?void 0:m.mobile)||""},theme:{color:"#2563eb"}};new window.Razorpay(e).open()},N=(null===f||void 0===f?void 0:f.key)&&(null===f||void 0===f?void 0:f.razorpayOrderId)&&(null===f||void 0===f?void 0:f.amount)&&(null===f||void 0===f?void 0:f.currency)&&Array.isArray(null===f||void 0===f?void 0:f.orderIds)&&f.orderIds.length>0;return(0,r.useEffect)(()=>{!y&&N&&(async()=>{if(window.Razorpay)return void b();const e=document.createElement("script");e.src="https://checkout.razorpay.com/v1/checkout.js",e.async=!0,document.body.appendChild(e),e.onload=()=>b(),e.onerror=()=>{o.oR.error("Failed to load Razorpay"),setTimeout(()=>g("/user"),1500)}})()},[y,N]),y?(0,d.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,d.jsx)(o.l$,{}),(0,d.jsx)("p",{className:"text-gray-600 text-lg",children:"Loading payment gateway..."})]}):N?(0,d.jsxs)("div",{className:"flex justify-center items-center h-screen bg-gray-50",children:[(0,d.jsx)(o.l$,{}),(0,d.jsxs)("div",{className:"bg-white p-8 rounded-xl shadow-md text-center max-w-md",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Redirecting to Razorpay..."}),(0,d.jsx)("p",{className:"text-gray-600 mb-4",children:"Please wait while we open the secure payment window."}),(0,d.jsx)("div",{className:"animate-pulse text-blue-600 font-medium",children:"Initializing Payment..."})]})]}):(0,d.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,d.jsx)(o.l$,{}),(0,d.jsx)("p",{className:"text-red-600 text-lg",children:"Invalid order data. Redirecting to dashboard..."})]})}},90837(e,s,t){t.d(s,{A:()=>r});const r=(0,t(4131).v)(e=>({user:null,wishlist:[],setUser:s=>e({user:s}),logout:()=>e({user:null,wishlist:[]}),setWishlist:s=>e({wishlist:s}),addToWishlist:s=>e(e=>({wishlist:[...e.wishlist,s]})),removeFromWishlist:s=>e(e=>({wishlist:e.wishlist.filter(e=>e.id!==s)}))}))}}]);
//# sourceMappingURL=7293.0518eb14.chunk.js.map