"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[9201],{69201(e,r,a){a.r(r),a.d(r,{default:()=>m});var t=a(65043),o=a(47874),s=a(24974),i=a(28845),d=a(79722),n=a(23768),c=a(70579);const l="checkout_order_data";function m(e){let{orderData:r,onSuccess:a,isCheckoutFlow:m=!1}=e;const{user:u,isAuthenticated:y,fetchUser:p}=(0,s.k)(),{clearCart:h}=(0,i.A)(),v=((0,o.zy)(),(0,o.Zp)()),[f,w]=(0,t.useState)(r),[x,g]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{if(m&&r)return w(r),void g(!1);const e=sessionStorage.getItem(l);if(e)return w(JSON.parse(e)),void g(!1);null!==u&&void 0!==u&&u.id&&await z(),g(!1)})()},[r,m,null===u||void 0===u?void 0:u.id]);const z=async()=>{try{const e=await d.A.get("".concat("https://sellaids.com","/api/payment/user/").concat(u.id,"/latest-order"),{withCredentials:!0});w(e.data.data)}catch(e){console.error("Failed to fetch latest order:",e),n.oR.error("Could not load order. Redirecting..."),setTimeout(()=>v("/user"),1500)}},R=()=>{if(!window.Razorpay)return;const e={key:f.key,order_id:f.razorpayOrderId,amount:f.amount,currency:f.currency,name:"Sellaids",description:"Payment for your order",handler:async e=>{try{(await d.A.post("".concat("https://sellaids.com","/api/payment/verify"),{razorpay_order_id:e.razorpay_order_id,razorpay_payment_id:e.razorpay_payment_id,razorpay_signature:e.razorpay_signature,orderIds:f.orderIds},{withCredentials:!0})).data.success?(n.oR.success("Payment Successful!"),await h(),sessionStorage.removeItem(l),a&&a(),setTimeout(()=>v("/user"),1500)):n.oR.error("Payment verification failed!")}catch(r){n.oR.error("Payment verification failed!")}},modal:{ondismiss:async()=>{n.oR.loading("Cancelling payment...");try{await d.A.post("".concat("https://sellaids.com","/api/payment/cancel"),{razorpayOrderId:f.razorpayOrderId,orderIds:f.orderIds},{withCredentials:!0}),n.oR.dismiss(),n.oR.error("Payment cancelled"),sessionStorage.removeItem(l),setTimeout(()=>v("/user"),1e3)}catch(e){n.oR.dismiss(),n.oR.error("Failed to cancel payment")}}},prefill:{name:(null===u||void 0===u?void 0:u.name)||"",email:(null===u||void 0===u?void 0:u.email)||"",contact:(null===u||void 0===u?void 0:u.mobile)||""},theme:{color:"#2563eb"}};new window.Razorpay(e).open()},j=(null===f||void 0===f?void 0:f.key)&&(null===f||void 0===f?void 0:f.razorpayOrderId)&&(null===f||void 0===f?void 0:f.amount)&&(null===f||void 0===f?void 0:f.currency)&&Array.isArray(null===f||void 0===f?void 0:f.orderIds)&&f.orderIds.length>0;return(0,t.useEffect)(()=>{!x&&j&&(async()=>{if(window.Razorpay)return void R();const e=document.createElement("script");e.src="https://checkout.razorpay.com/v1/checkout.js",e.async=!0,document.body.appendChild(e),e.onload=()=>R(),e.onerror=()=>{n.oR.error("Failed to load Razorpay"),setTimeout(()=>v("/user"),1500)}})()},[x,j]),x?(0,c.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,c.jsx)(n.l$,{}),(0,c.jsx)("p",{className:"text-gray-600 text-lg",children:"Loading payment gateway..."})]}):j?(0,c.jsxs)("div",{className:"flex justify-center items-center h-screen bg-gray-50",children:[(0,c.jsx)(n.l$,{}),(0,c.jsxs)("div",{className:"bg-white p-8 rounded-xl shadow-md text-center max-w-md",children:[(0,c.jsx)("h1",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Redirecting to Razorpay..."}),(0,c.jsx)("p",{className:"text-gray-600 mb-4",children:"Please wait while we open the secure payment window."}),(0,c.jsx)("div",{className:"animate-pulse text-blue-600 font-medium",children:"Initializing Payment..."})]})]}):(0,c.jsxs)("div",{className:"flex justify-center items-center h-screen",children:[(0,c.jsx)(n.l$,{}),(0,c.jsx)("p",{className:"text-red-600 text-lg",children:"Invalid order data. Redirecting to dashboard..."})]})}}}]);
//# sourceMappingURL=9201.798f1292.chunk.js.map